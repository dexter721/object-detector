<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>AI Object Detector with Voice</title>
  <style>
    body { text-align: center; font-family: sans-serif; }
    video { border: 2px solid black; width: 80%; max-width: 640px; margin: 10px auto; }
    canvas { display: none; }
    button { margin: 10px; padding: 10px 20px; font-size: 16px; }
  </style>
</head>
<body>
  <h1>‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏π‡∏î</h1>
  <video id="webcam" autoplay muted></video>
  <canvas id="canvas"></canvas>
  <p id="label">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏•...</p>

  <div>
    <button onclick="toggleCamera()">üîÅ ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
    <button onclick="changeVolume(0.1)">üîä ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏á</button>
    <button onclick="changeVolume(-0.1)">üîâ ‡∏•‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.15.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
  <script>
    const video = document.getElementById('webcam');
    const label = document.getElementById('label');
    let model;
    let isCameraOn = true;
    let stream = null;
    let volumeLevel = 1.0;
    const labelDict = {
      "chair": "‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ",
      "couch": "‡πÇ‡∏ã‡∏ü‡∏≤",
      "bed": "‡πÄ‡∏ï‡∏µ‡∏¢‡∏á",
      "dining table": "‡πÇ‡∏ï‡πä‡∏∞",
      "tv": "‡∏ó‡∏µ‡∏ß‡∏µ",
      "cell phone": "‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå",
      "book": "‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠",
      "bottle": "‡∏Ç‡∏ß‡∏î",
      "cup": "‡∏ñ‡πâ‡∏ß‡∏¢",
      "bowl": "‡∏ä‡∏≤‡∏°",
      "remote": "‡∏£‡∏µ‡πÇ‡∏°‡∏ó",
      "mouse": "‡πÄ‡∏°‡∏≤‡∏™‡πå",
      "keyboard": "‡∏Ñ‡∏µ‡∏¢‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î",
      "laptop": "‡πÇ‡∏ô‡πâ‡∏ï‡∏ö‡∏∏‡πä‡∏Å",
      "microwave": "‡πÑ‡∏°‡πÇ‡∏Ñ‡∏£‡πÄ‡∏ß‡∏ü",
      "sports ball": "‡∏•‡∏π‡∏Å‡∏ö‡∏≠‡∏•",
      "scissors": "‡∏Å‡∏£‡∏£‡πÑ‡∏Å‡∏£",
      "backpack": "‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤",
      "teddy bear": "‡∏ï‡∏∏‡πä‡∏Å‡∏ï‡∏≤",
      "pen": "‡∏õ‡∏≤‡∏Å‡∏Å‡∏≤",
      "pencil": "‡∏î‡∏¥‡∏ô‡∏™‡∏≠",
      "eraser": "‡∏¢‡∏≤‡∏á‡∏•‡∏ö",
      "headphones": "‡∏´‡∏π‡∏ü‡∏±‡∏á",
      "box": "‡∏Å‡∏•‡πà‡∏≠‡∏á"
    };

    let lastSpokenTimes = {};

    async function setupCamera() {
      stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: "environment" },
        audio: false
      });
      video.srcObject = stream;
      return new Promise(resolve => {
        video.onloadedmetadata = () => resolve(video);
      });
    }

    function speak(text) {
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = "th-TH";
      utter.volume = volumeLevel;
      speechSynthesis.speak(utter);
    }

    async function detectFrame() {
      if (!isCameraOn || !model) return;

      const predictions = await model.detect(video);
      if (predictions.length > 0) {
        let found = false;
        for (const prediction of predictions) {
          const name = prediction.class;
          if (labelDict[name]) {
            const thaiName = labelDict[name];
            const now = Date.now();
            if (!lastSpokenTimes[thaiName] || now - lastSpokenTimes[thaiName] > 3000) {
              label.textContent = `‡∏û‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏: ${thaiName}`;
              speak(thaiName);
              lastSpokenTimes[thaiName] = now;
            } else {
              label.textContent = `‡∏û‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏: ${thaiName} (‡∏£‡∏≠‡∏û‡∏π‡∏î‡πÉ‡∏´‡∏°‡πà)`;
            }
            found = true;
            break;
          }
        }
        if (!found) {
          label.textContent = "‡∏û‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡πÑ‡∏°‡πà‡∏û‡∏π‡∏î)";
        }
      } else {
        label.textContent = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏";
      }

      requestAnimationFrame(detectFrame);
    }

    function toggleCamera() {
      if (isCameraOn) {
        stopCamera();
      } else {
        startCamera();
      }
    }

    function stopCamera() {
      isCameraOn = false;
      if (stream) {
        stream.getTracks().forEach(track => track.stop());
        video.srcObject = null;
      }
      label.textContent = "‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏ñ‡∏π‡∏Å‡∏õ‡∏¥‡∏î";
    }

    async function startCamera() {
      isCameraOn = true;
      await setupCamera();
      video.play();
      label.textContent = "‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö...";
      detectFrame();
    }

    function changeVolume(delta) {
      volumeLevel = Math.min(1, Math.max(0, volumeLevel + delta));
      label.textContent = `‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á: ${(volumeLevel * 100).toFixed(0)}%`;
    }

    async function main() {
      await startCamera();
      model = await cocoSsd.load();
      label.textContent = "‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß!";
      detectFrame();
    }

    main();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>ระบบตรวจจับวัตถุพร้อมเสียงภาษาไทย</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 20px;
    }
    video {
      border: 2px solid black;
      width: 80%;
      max-width: 640px;
      margin: 10px 0;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>ระบบตรวจจับวัตถุพร้อมเสียงภาษาไทย</h1>

  <video id="video" autoplay muted></video>
  <div>
    <button onclick="toggleCamera()">เปิด/ปิดกล้อง</button>
    <button onclick="changeVolume(0.1)">เพิ่มเสียง</button>
    <button onclick="changeVolume(-0.1)">ลดเสียง</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.9.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>

  <script>
    const video = document.getElementById('video');
    let stream = null;
    let isCameraOn = false;
    let volume = 1.0;

    // รายชื่อวัตถุที่แปลเป็นภาษาไทยเท่านั้น
    const labelMap = {
      "chair": "เก้าอี้",
      "bed": "เตียง",
      "couch": "โซฟา",
      "tv": "ทีวี",
      "remote": "รีโมท",
      "cell phone": "โทรศัพท์",
      "book": "หนังสือ",
      "cup": "ถ้วย",
      "bottle": "ขวด",
      "bowl": "จาน",
      "spoon": "ช้อน",
      "fork": "ส้อม",
      "keyboard": "คีย์บอร์ด",
      "mouse": "เมาส์",
      "laptop": "โน้ตบุ๊ก",
      "backpack": "กระเป๋า",
      "handbag": "กระเป๋า",
      "scissors": "กรรไกร",
      "toothbrush": "แปรงสีฟัน",
      "potted plant": "ต้นไม้",
      "dining table": "โต๊ะ",
      "microwave": "ไมโครเวฟ",
      "oven": "เตาอบ",
      "sink": "อ่างล้างจาน",
      "refrigerator": "ตู้เย็น",
      "teddy bear": "ตุ๊กตา",
      "sports ball": "ลูกบอล",
      "toy": "ของเล่น",
      "computer": "คอมพิวเตอร์",
      "pen": "ปากกา",
      "pencil": "ดินสอ",
      "eraser": "ยางลบ",
      "headphones": "หูฟัง",
      "box": "กล่อง"
    };

    const spokenLabels = {};
    const speakDelay = 3000; // 3 วินาที

    function speak(text) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = "th-TH";
      utterance.volume = volume;
      speechSynthesis.speak(utterance);
    }

    async function startCamera() {
      try {
        stream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = stream;
        isCameraOn = true;
      } catch (err) {
        alert("ไม่สามารถเปิดกล้องได้: " + err.message);
      }
    }

    function stopCamera() {
      if (stream) {
        stream.getTracks().forEach(track => track.stop());
        video.srcObject = null;
        isCameraOn = false;
      }
    }

    function toggleCamera() {
      if (isCameraOn) {
        stopCamera();
      } else {
        startCamera();
      }
    }

    function changeVolume(delta) {
      volume = Math.min(1, Math.max(0, volume + delta));
      console.log("ระดับเสียง:", volume);
    }

    // โหลดโมเดลและเริ่มตรวจจับ
    cocoSsd.load().then(model => {
      console.log("โมเดลโหลดเสร็จแล้ว");

      setInterval(async () => {
        if (!isCameraOn) return;
        const predictions = await model.detect(video);

        predictions.forEach(prediction => {
          const engLabel = prediction.class;
          const thaiLabel = labelMap[engLabel];

          if (thaiLabel) {
            const now = Date.now();
            if (!spokenLabels[thaiLabel] || now - spokenLabels[thaiLabel] > speakDelay) {
              speak(thaiLabel);
              spokenLabels[thaiLabel] = now;
            }
          }
        });
      }, 500);
    });
  </script>
</body>
</html>
